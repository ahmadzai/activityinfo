
import org.ajoberstar.grgit.Grgit


allprojects {

    def repo = Grgit.open(project.rootDir)
    def majorVersion = "2.8"

    
    if(System.env.PIPELINE_VERSION) {
        // Resuming an existing pipeline
        project.version = "${majorVersion}.${System.env.PIPELINE_VERSION}"
        project.ext.buildNumber = System.env.PIPELINE_VERSION
    
    } else if(System.env.BUILD_NUMBER) {
        // Starting a new pipeline build
        project.version = "${majorVersion}.${System.env.BUILD_NUMBER}"
        project.ext.buildNumber = System.env.BUILD_NUMBER
    
    } else {
        // Development
        project.version = "${majorVersion}-dev"      
        project.ext.buildNumber = 'dev'
    }
    
    // Override the build number to support deploying past builds to
    // new environments etc
    if(project.hasProperty('build')) {
        project.ext.buildNumber = Integer.parseInt(project.property('build'))
    }
    
    ext.commitId = repo.head().id

}
